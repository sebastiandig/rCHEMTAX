---
title: "CHEMTAX Main"
author: "Sebastian DiGeronimo"
date: "6/2/2022"
output:
  html_document: default
  pdf_document: default
---

### Intro: 
This will serve as my starting point for converting CHEMTAX V2.0 into R.
#TODO: fix this: [CHEMTAX Document](./Re__CHEMTAX_Update_[SEC=OFFICIAL]/Re__CHEMTAX_Update_[SEC=OFFICIAL]/CHEMTAX 2 Octave version.docx)

`r gsub("\\.m$","", list.files(path = "./Re__CHEMTAX_Update_[SEC=OFFICIAL]/MatrixFactorsOctave/", pattern="\\.m$"))`
# Files that need to be converted
double tilde ~ will show done

21 - not all are .m files with functions
o 0 mostly done
* 20 finished
! 0 not started
x 2 not needed

1
* "adddir"                        ---- *x*
                                       - I don't think I need this
2
* "amatfactsd"                    ---- *finished*
                                       needs works with creating the two matrices
3
* "bmatfactsd"                    ---- *finished* 
                                       - it works, but I don't know what for
4
* "bootln"                        ---- *finished* 
                                       - connected to `nnmatfactsd`
5
* "bootnp"                        ---- *finished*
                                       - connected to `nnmatfactsd`
6
* "brokewest"                     ---- *finished*
                                       - connected to `chemtaxbrokewest`, 
                                       `nnmatfactsd`,  `normprod`, `regplot`, 
                                       `randstart`, `bootln`, `bootnp`
7
* "chemtaxbrokewest"              ---- *finished* 
                                       - connected to `permcalc`, file for `s`  
                                       and `scol` as `CHEMTAXBROKEWests`, file    
                                       for `f0`, `taxa` and `fcol` as 
                                       `pigment_ratios.csv`
8
* "CHEMTAXBROKEWestb"             ---- *finished*
                                       - TODO: create `matfactuvw` and test
                                       - connected to `matfactuvw`, `permcalc`,
                                       file for `b` as `b_pigment_ratios.csv`, 
                                       file for `x` as `CHEMTAXBROKEWestx.csv``
9
* "CHEMTAXBROKEWests"             ---- *finished*, as .csv in `data/raw/`  
10
* "CHEMTAXBROKEWestx"             ---- *finished*, as .csv in `data/raw/`
11
* "dataout"                       ---- *x*
                                       probably don't need     
12
* "Formulas"                      ---- *finished*, doesn't connect to anything and 
                                       is not a function, not sure what do do with it
13                                       
* "initstruct"                    ---- *finished*    
14
* "matfactuvw"                    ---- *finished*
                                       - connected to  `initstruct`
15
* "nnmatfactsd"                   ---- *finished*  
                                       - connected to `amatfactsd`
16
* "normprod"                      ---- *finished* 
17
* "permcalc"                      ---- *finished*       
18
* "randstart"                     ---- *finished*
                                       - connect to `nnmatfactsd`
19
* "regplot"                       ---- *finished*
                                       - connected to `nnmatfactsd`
20
* "saz"                           ---- *finished*
                                       - connected to `sazchemtax090210`, 
                                       `nnmatfactsd`,  `normprod`, `regplot`, 
                                       `randstart`, `bootln`, `bootnp`
21
* "sazchemtax090210"              ----  *finished* 
                                        - connected to `permcalc`, file for `s`  
                                        and `scol` as `SAZS_CHEMTAX090210s.csv`, 
                                        file for `f0`, `taxa` and `fcol` as 
                                        `saz_pigment_ratios.csv`
22
* "SAZS_CHEMTAX090210s"           ---- *finished*, as .csv in `data/raw/`

## To test `nnmatfactsd` and `amatfactsd` - start with 
    - brokewest.R to line 57, that'll be the inputs to `nnmatfactsd`

# Matlab to R notes:
* length(x) = largest of the dimensions, so if 100 x 4 = 100, or 4 x 100 = 100
* `*` is matrix multiply, 
* `.*` & `./` are matrix element by element multiply & divide operations
* can use `pracma::rand()` for rand
* `repmat` is used to replicate a matrix by x * y, ie repmat({matrix 5 x 4}, 2, 4)
  result would be matrix 2 x 16, so 8 replicates of the original matrix where 
  stacked twice and multiplied by 4
* mod(a,m) is same as a %% m in R
* df(:) puts matrix into 1 column
* df(end) gets the last digit, bottom right of matrix


#TODO: something to include is:
This would load internal ratios file so that you have a basic pigment ratio var
pigment_ratio <- system.file("", package = "rCHEMTAX")

Plotting Log function:
# allow y log style plotting from Matlab in semilogy
  fancy_scientific <- function(l) {
    # turn in to character string in scientific notation
    l <- format(l, scientific = TRUE)
    # quote the part before the exponent to keep all the digits
    l <- gsub("^(.*)e", "'\\1'e", l)
    # turn the 'e+' into plotmath format
    l <- gsub("e", "%*%10^", l)
    # return this as an expression
    parse(text=l)
  }
  
  yticks = outer((1:10),(10^(-5:-1)))
  xticks = outer((1:10),(10^(0:1)))
  
  include either:
  * semi-logx
  scale_x_log10(limits = c(1, 100),
                labels = fancy_scientific,
                minor_breaks = xticks) +
  * semi-logy
  scale_y_log10(limits = c(1e-5, 1),
                labels = fancy_scientific,
                minor_breaks = yticks) +
    


```{r setup, include=FALSE, message=FALSE}
root <- rprojroot::find_rstudio_root_file()
library("knitr")
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = root)
library("tidyverse")
library("dplyr")
library("lubridate")
library("vroom")


```

```{r create-dir}
# will create a set directory if does not exists
# useful for new projects
mainDir <- rprojroot::find_rstudio_root_file()
subDir <-
    c("data/raw",
      "data/processed",
      "data/plots",
      "data/metadata",
      "Rmd",
      "scripts")

fs::dir_create(path = paste0(mainDir,"/",subDir))
rm(mainDir, subDir)
```

this is a test help me
```{r}
readr::read_csv("./data/raw/SAZS_CHEMTAX090210s.csv")

```

```{r}
# testa <- info$inita  
# testb <- info$initb
# 
# dim(testa)
# dim(testb)
# 
# s - (testa %*%  testb)


```

